# 📦 大容量ファイル対応版

## ✨ 新機能

✅ **最大2GBのファイルをアップロード可能**  
✅ **最大2時間の音源に対応**  
✅ **チャンク処理で長時間音源も高速解析**  
✅ **進捗バー表示**  

---

## 📊 対応範囲

| 項目 | 対応 |
|-----|------|
| ファイルサイズ | 最大2GB |
| 音源時間 | 最大2時間 |
| 形式 | WAV, MP3, FLAC |
| 基本解析 | 全サイズ対応 |
| 楽器分離 | 500MB以下推奨 |

---

## 🚀 セットアップ

### 必須ファイル

```
ultra_simple/
├── pa_analyzer_ultra_simple.py    ← メインアプリ
└── .streamlit/
    └── config.toml                 ← 設定ファイル
```

### インストール

```bash
pip install streamlit numpy scipy matplotlib librosa soundfile
```

### 起動

```bash
streamlit run pa_analyzer_ultra_simple.py
```

---

## 💡 使い方

### 小さいファイル（100MB以下）
- 通常通り一括読み込み
- 高速処理（5秒）

### 大きいファイル（100MB～2GB）
- 自動的にチャンク処理
- 進捗バー表示
- 若干時間がかかる（30秒～数分）

### 楽器分離使用時
- 500MB以下推奨
- それ以上は基本解析のみ

---

## 📈 処理時間の目安

| 音源時間 | サイズ | 基本解析 | 楽器分離 |
|---------|--------|---------|---------|
| 3分 | 30MB | 5秒 | 2-3分 |
| 10分 | 100MB | 10秒 | 5-8分 |
| 30分 | 300MB | 30秒 | 使用不可 |
| 1時間 | 600MB | 1分 | 使用不可 |
| 2時間 | 1.2GB | 2分 | 使用不可 |

※CPU版の場合。GPU版はさらに高速

---

## ⚙️ 技術的な仕組み

### チャンク処理
- 30秒ごとに分割して読み込み
- メモリ使用量を大幅削減
- 長時間音源でもクラッシュしない

### 自動判定
- 100MB以下：一括読み込み（高速）
- 100MB以上：チャンク処理（安全）

---

## 🎯 実用例

### ライブ録音（1時間）
```
サイズ: 600MB
基本解析: 1分で完了
楽器分離: 使用不可（サイズ超過）
```

### リハーサル（30分）
```
サイズ: 300MB
基本解析: 30秒で完了
楽器分離: 使用不可（サイズ超過）
```

### 1曲（5分）
```
サイズ: 50MB
基本解析: 5秒で完了
楽器分離: 3分で完了 ✅
```

---

## ⚠️ 注意事項

### 楽器分離の制限
- 500MB以上のファイルでは使用不可
- 理由：メモリ消費が大きすぎる
- 解決策：基本解析のみ使用

### ブラウザのメモリ
- 大容量ファイルはブラウザのメモリを消費
- 2GB近いファイルは動作が重くなる可能性
- 推奨：1GB以下

### ディスク容量
- 一時ファイルとして保存される
- 解析後は自動削除
- 十分な空き容量を確保

---

## 🆘 トラブルシューティング

### エラー: アップロードできない

**.streamlitフォルダが必要です**
```bash
mkdir -p .streamlit
# config.tomlをコピー
```

### エラー: メモリ不足

**対処法**:
1. ファイルを分割
2. チャンク処理が自動的に働く
3. それでもダメなら音源を短くする

### 処理が遅い

**原因と対策**:
- CPU版：GPU版に変更
- 大容量ファイル：チャンク処理中（待つ）
- 楽器分離：処理を諦める（基本解析のみ）

---

## 🎊 まとめ

**10GBは現実的に厳しいですが、2GBまで対応しました！**

- ライブ全体の録音も解析可能
- 長時間リハーサルも対応
- チャンク処理で安定動作

**実用上は十分すぎる範囲です！** 🚀
